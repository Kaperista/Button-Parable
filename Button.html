<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—É–∑–µ–π –ú–µ—Ç–∞-–ö–Ω–æ–ø–æ–∫</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
        }

        .glitch {
            animation: glitchAnim 0.3s infinite;
        }

        @keyframes glitchAnim {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        .narrator-box {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 30px;
            max-width: 700px;
            margin-bottom: 40px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            min-height: 150px;
        }

        .narrator-text {
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .typing::after {
            content: '‚ñä';
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .button-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }

        .meta-button {
            padding: 15px 40px;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border: 3px solid #00ff88;
            background: rgba(0, 255, 136, 0.1);
            color: #00ff88;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            position: relative;
            border-radius: 5px;
        }

        .meta-button:hover {
            background: rgba(0, 255, 136, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            transform: scale(1.05);
        }

        .meta-button.runaway {
            position: fixed;
            transition: all 0.5s ease-out;
        }

        .stats {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border: 1px solid #00ff88;
            border-radius: 5px;
            font-size: 12px;
            min-width: 200px;
        }

        .stats-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .invisible-button {
            opacity: 0;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .invisible-button:hover {
            opacity: 0.3;
        }

        .achievement {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            animation: slideDown 0.5s, slideUp 0.5s 2.5s;
            display: none;
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); }
            to { transform: translate(-50%, 0); }
        }

        @keyframes slideUp {
            from { transform: translate(-50%, 0); }
            to { transform: translate(-50%, -100%); }
        }

        .visit-counter {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border: 1px solid #ff4444;
            border-radius: 5px;
            font-size: 11px;
        }

        @media (max-width: 768px) {
            .narrator-box {
                padding: 20px;
                max-width: 90%;
            }
            
            .narrator-text {
                font-size: 16px;
            }

            .stats {
                font-size: 10px;
                min-width: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="achievement" id="achievement"></div>
    
    <div class="stats" id="stats">
        <div class="stats-item">
            <span>–ö–Ω–æ–ø–æ–∫ –Ω–∞–∂–∞—Ç–æ:</span>
            <span id="clickCount">0</span>
        </div>
        <div class="stats-item">
            <span>–ë–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç—å:</span>
            <span id="meaningless">0%</span>
        </div>
        <div class="stats-item">
            <span>–≠–∫–∑–∏—Å—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∫—Ä–∏–∑–∏—Å:</span>
            <span id="crisis">–Ω–∏–∑–∫–∏–π</span>
        </div>
    </div>

    <div class="visit-counter" id="visitCounter"></div>

    <div class="narrator-box" id="narratorBox">
        <div class="narrator-text" id="narratorText"></div>
        <div class="button-container" id="buttonContainer"></div>
    </div>

    <audio id="ambientSound" loop>
        <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=" type="audio/wav">
    </audio>

    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ DevTools
        let devToolsOpen = false;
        const checkDevTools = () => {
            const threshold = 160;
            devToolsOpen = window.outerWidth - window.innerWidth > threshold || 
                          window.outerHeight - window.innerHeight > threshold;
        };
        setInterval(checkDevTools, 1000);

        // –ö–æ–Ω—Å–æ–ª—å–Ω—ã–µ –ø–∞—Å—Ö–∞–ª–∫–∏
        console.log('%c–ê –≤—ã –ª—é–±–æ–ø—ã—Ç–Ω—ã–π...', 'color: #00ff88; font-size: 20px; font-weight: bold;');
        console.log('%c–†–∞—Å—Å–∫–∞–∑—á–∏–∫ –≤–∏–¥–∏—Ç –≤—Å—ë.', 'color: #ff4444; font-size: 14px;');
        console.log('%c–î–∞–∂–µ –∑–¥–µ—Å—å.', 'color: #ffff00; font-size: 12px;');

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        const state = {
            stage: 0,
            clicks: 0,
            path: [],
            achievements: new Set(),
            startTime: Date.now(),
            idleTime: 0,
            visits: 0
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
        const savedVisits = parseInt(localStorage.getItem('museumVisits') || '0');
        state.visits = savedVisits + 1;
        localStorage.setItem('museumVisits', state.visits);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('clickCount').textContent = state.clicks;
            document.getElementById('meaningless').textContent = Math.min(100, state.clicks * 7) + '%';
            
            const crisisLevels = ['–Ω–∏–∑–∫–∏–π', '—Å—Ä–µ–¥–Ω–∏–π', '–≤—ã—Å–æ–∫–∏–π', '–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π', '–ó–ê–ü–†–ï–î–ï–õ–¨–ù–´–ô'];
            const crisisIndex = Math.min(4, Math.floor(state.clicks / 5));
            document.getElementById('crisis').textContent = crisisLevels[crisisIndex];
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –≤–∏–∑–∏—Ç–æ–≤
        function updateVisitCounter() {
            const counter = document.getElementById('visitCounter');
            if (state.visits === 1) {
                counter.textContent = '–ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç';
            } else if (state.visits < 5) {
                counter.textContent = `–í–∏–∑–∏—Ç ‚Ññ${state.visits}. –í—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å...`;
            } else {
                counter.textContent = `–í–∏–∑–∏—Ç ‚Ññ${state.visits}. –í–∞–º –∑–¥–µ—Å—å –Ω—Ä–∞–≤–∏—Ç—Å—è?`;
            }
        }

        // –ü–æ–∫–∞–∑ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        function showAchievement(text) {
            const ach = document.getElementById('achievement');
            ach.textContent = 'üèÜ ' + text;
            ach.style.display = 'block';
            setTimeout(() => {
                ach.style.display = 'none';
            }, 3000);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—á–∞—Ç–∏
        function typeText(element, text, callback) {
            element.textContent = '';
            element.classList.add('typing');
            let i = 0;
            
            const interval = setInterval(() => {
                if (i < text.length) {
                    element.textContent += text[i];
                    i++;
                } else {
                    clearInterval(interval);
                    element.classList.remove('typing');
                    if (callback) callback();
                }
            }, 30);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫
        function createButtons(buttons) {
            const container = document.getElementById('buttonContainer');
            container.innerHTML = '';
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = 'meta-button';
                button.textContent = btn.text;
                button.onclick = () => {
                    state.clicks++;
                    state.path.push(btn.id);
                    updateStats();
                    btn.action();
                };
                
                if (btn.special === 'runaway') {
                    button.onmouseenter = () => {
                        if (!button.classList.contains('runaway')) {
                            button.classList.add('runaway');
                            const x = Math.random() * (window.innerWidth - 200);
                            const y = Math.random() * (window.innerHeight - 100);
                            button.style.left = x + 'px';
                            button.style.top = y + 'px';
                        }
                    };
                }
                
                container.appendChild(button);
            });
        }

        // –°—Ü–µ–Ω–∞—Ä–∏–∏
        const scenarios = {
            start: () => {
                let text = '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ú—É–∑–µ–π –ú–µ—Ç–∞-–ö–Ω–æ–ø–æ–∫. ';
                
                if (state.visits > 1) {
                    text = `–û. –í—ã —Å–Ω–æ–≤–∞ –∑–¥–µ—Å—å. –≠—Ç–æ –≤–∞—à –≤–∏–∑–∏—Ç –Ω–æ–º–µ—Ä ${state.visits}. ${
                        state.visits > 5 ? '–í–∞–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–µ—á–µ–º –∑–∞–Ω—è—Ç—å—Å—è?' : '–Ø... —Å–∫—É—á–∞–ª.'
                    } `;
                }
                
                text += '–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –∫–Ω–æ–ø–∫–∞ ¬´–ù–ê–ß–ê–¢–¨¬ª. –ù–∞–∂–º–∏—Ç–µ –µ—ë. –ò–ª–∏ –Ω–µ –Ω–∞–∂–∏–º–∞–π—Ç–µ. –ù–æ –º—ã –æ–±–∞ –∑–Ω–∞–µ–º, —á—Ç–æ –≤—ã –Ω–∞–∂–º—ë—Ç–µ.';
                
                const narratorText = document.getElementById('narratorText');
                typeText(narratorText, text, () => {
                    createButtons([
                        {
                            id: 'start',
                            text: '–ù–ê–ß–ê–¢–¨',
                            action: scenarios.choice1
                        }
                    ]);
                });
            },

            choice1: () => {
                const texts = [
                    '–û—Ç–ª–∏—á–Ω–æ. –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –Ω–æ –æ—Ç–ª–∏—á–Ω–æ. –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –≤—ã–±–æ—Ä. –ö—Ä–∞—Å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –∏–ª–∏ –°–∏–Ω—è—è –∫–Ω–æ–ø–∫–∞. –í—ã–±–∏—Ä–∞–π—Ç–µ –º—É–¥—Ä–æ. –•–æ—Ç—è —ç—Ç–æ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è.',
                    '–í—ã –Ω–∞–∂–∞–ª–∏ –∫–Ω–æ–ø–∫—É. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é. –≠—Ç–æ –±—ã–ª–æ —Å–ª–æ–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ? –°–µ–π—á–∞—Å –±—É–¥–µ—Ç —Å–ª–æ–∂–Ω–µ–µ.'
                ];
                
                if (devToolsOpen && !state.achievements.has('hacker')) {
                    state.achievements.add('hacker');
                    showAchievement('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: –•–∞–∫–µ—Ä. –í—ã –æ—Ç–∫—Ä—ã–ª–∏ –∫–æ–Ω—Å–æ–ª—å. –Ø –≤–∏–∂—É –≤–∞—Å.');
                }
                
                typeText(document.getElementById('narratorText'), texts[Math.floor(Math.random() * texts.length)], () => {
                    createButtons([
                        {
                            id: 'red',
                            text: '–ö–†–ê–°–ù–ê–Ø',
                            action: scenarios.redPath
                        },
                        {
                            id: 'blue',
                            text: '–°–ò–ù–Ø–Ø',
                            action: scenarios.bluePath
                        },
                        {
                            id: 'wait',
                            text: '–ü–û–î–û–ñ–î–ê–¢–¨',
                            action: scenarios.waitPath
                        }
                    ]);
                });
            },

            redPath: () => {
                const box = document.getElementById('narratorBox');
                box.classList.add('glitch');
                setTimeout(() => box.classList.remove('glitch'), 300);
                
                typeText(document.getElementById('narratorText'), 
                    '–ö—Ä–∞—Å–Ω–∞—è. –ö–ª–∞—Å—Å–∏–∫–∞. –í—ã –≤—ã–±—Ä–∞–ª–∏ –æ–ø–∞—Å–Ω–æ—Å—Ç—å. –ò–ª–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å? –Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–º–Ω—é. –í –ª—é–±–æ–º —Å–ª—É—á–∞–µ, —Ç–µ–ø–µ—Ä—å –ø–æ—è–≤–∏—Ç—Å—è –∫–Ω–æ–ø–∫–∞, –∫–æ—Ç–æ—Ä–∞—è —É–±–µ–≥–∞–µ—Ç –æ—Ç –≤–∞—Å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–π–º–∞—Ç—å –µ—ë. –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è —Å—é–∂–µ—Ç–∞.', 
                    () => {
                        createButtons([
                            {
                                id: 'runaway',
                                text: '–ü–û–ô–ú–ê–ô –ú–ï–ù–Ø',
                                special: 'runaway',
                                action: scenarios.caughtButton
                            },
                            {
                                id: 'give_up',
                                text: '–°–î–ê–¢–¨–°–Ø',
                                action: scenarios.giveUp
                            }
                        ]);
                    }
                );
            },

            bluePath: () => {
                typeText(document.getElementById('narratorText'), 
                    '–°–∏–Ω—è—è. –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ. –ó–Ω–∞–µ—Ç–µ –ª–∏ –≤—ã, —á—Ç–æ —Å–∏–Ω–∏–π —Ü–≤–µ—Ç —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ? –ò–ª–∏ –ø–µ—á–∞–ª—å? –ù–∞–≤–µ—Ä–Ω–æ–µ, –≤—Ç–æ—Ä–æ–µ –≤ –≤–∞—à–µ–º —Å–ª—É—á–∞–µ. –ü–æ—Ç–æ–º—É —á—Ç–æ –≤–ø–µ—Ä–µ–¥–∏ —Ç–æ–ª—å–∫–æ –ø—É—Å—Ç–æ—Ç–∞. –ò –µ—â—ë –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞.', 
                    () => {
                        createButtons([
                            {
                                id: 'void',
                                text: '–í –ü–£–°–¢–û–¢–£',
                                action: scenarios.voidPath
                            },
                            {
                                id: 'back',
                                text: '–ù–ê–ó–ê–î',
                                action: scenarios.backPath
                            }
                        ]);
                    }
                );
            },

            waitPath: () => {
                if (!state.achievements.has('philosopher')) {
                    state.achievements.add('philosopher');
                    showAchievement('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: –§–∏–ª–æ—Å–æ—Ñ. –í—ã –≤—ã–±—Ä–∞–ª–∏ —Å–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ.');
                }
                
                typeText(document.getElementById('narratorText'), 
                    '–ê—Ö. –í—ã–±–æ—Ä –Ω–µ –≤—ã–±–∏—Ä–∞—Ç—å. –ì–ª—É–±–æ–∫–æ–º—ã—Å–ª–µ–Ω–Ω–æ. –í—ã –ø—Ä–æ—Å—Ç–æ —Å—Ç–æ–∏—Ç–µ –∑–¥–µ—Å—å –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —ç–∫—Ä–∞–Ω. –ö–∞–∫ –±—É–¥—Ç–æ –∂–¥—ë—Ç–µ —á–µ–≥–æ-—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–≥–æ. –°–ø–æ–π–ª–µ—Ä: –Ω–µ –¥–æ–∂–¥—ë—Ç–µ—Å—å. –ù–æ –≤–æ—Ç –≤–∞–º –∫–Ω–æ–ø–∫–∞ –∑–∞ —Ç–µ—Ä–ø–µ–Ω–∏–µ.', 
                    () => {
                        createButtons([
                            {
                                id: 'patience',
                                text: '–ë–õ–ê–ì–û–î–ê–†–Æ',
                                action: scenarios.nirvana
                            }
                        ]);
                    }
                );
            },

            caughtButton: () => {
                if (!state.achievements.has('hunter')) {
                    state.achievements.add('hunter');
                    showAchievement('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: –û—Ö–æ—Ç–Ω–∏–∫. –í—ã –ø–æ–π–º–∞–ª–∏ —É–±–µ–≥–∞—é—â—É—é –∫–Ω–æ–ø–∫—É.');
                }
                
                typeText(document.getElementById('narratorText'), 
                    '–í–ø–µ—á–∞—Ç–ª—è—é—â–µ. –í—ã –ø–æ–π–º–∞–ª–∏ –∫–Ω–æ–ø–∫—É. –í–∞—à–∞ –Ω–∞–≥—Ä–∞–¥–∞: –æ—Å–æ–∑–Ω–∞–Ω–∏–µ —Ç–æ–≥–æ, —á—Ç–æ –≤—ã –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏ –≤—Ä–µ–º—è –Ω–∞ –ø–æ–≥–æ–Ω—é –∑–∞ –ø–∏–∫—Å–µ–ª—è–º–∏. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é. –•–æ—Ç–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º —ç—Ç–æ—Ç –∞–±—Å—É—Ä–¥?', 
                    () => {
                        createButtons([
                            {
                                id: 'repeat',
                                text: '–ï–©–Å –†–ê–ó',
                                action: scenarios.repetitionPath
                            },
                            {
                                id: 'continue',
                                text: '–ü–†–û–î–û–õ–ñ–ò–¢–¨',
                                action: scenarios.finalChoice
                            }
                        ]);
                    }
                );
            },

            giveUp: () => {
                typeText(document.getElementById('narratorText'), 
                    '–í—ã —Å–¥–∞–ª–∏—Å—å. –ú—É–¥—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ. –ó–∞—á–µ–º –≥–Ω–∞—Ç—å—Å—è –∑–∞ —Ç–µ–º, —á—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç –±—ã—Ç—å –ø–æ–π–º–∞–Ω–Ω—ã–º? –≠—Ç–æ –º–µ—Ç–∞—Ñ–æ—Ä–∞ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏? –ò–∑–≤–∏–Ω–∏—Ç–µ, —Å–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–æ. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏–º.', 
                    () => {
                        createButtons([
                            {
                                id: 'continue',
                                text: '–ü–†–û–î–û–õ–ñ–ò–¢–¨',
                                action: scenarios.finalChoice
                            }
                        ]);
                    }
                );
            },

            voidPath: () => {
                document.body.style.background = '#000';
                setTimeout(() => {
                    document.body.style.background = 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)';
                }, 2000);
                
                typeText(document.getElementById('narratorText'), 
                    '–í—ã —à–∞–≥–Ω—É–ª–∏ –≤ –ø—É—Å—Ç–æ—Ç—É. –¢–∞–º —Ç–µ–º–Ω–æ. –ò —Ç–∏—Ö–æ. –ò –Ω–µ–º–Ω–æ–≥–æ –Ω–µ—É—é—Ç–Ω–æ. –í–ø—Ä–æ—á–µ–º, –≤—ã –º–æ–∂–µ—Ç–µ –≤–µ—Ä–Ω—É—Ç—å—Å—è. –ü—É—Å—Ç–æ—Ç–∞ –Ω–µ –æ–±–∏–∂–∞–µ—Ç—Å—è. –û–Ω–∞ –≤–æ–æ–±—â–µ –Ω–∏—á–µ–≥–æ –Ω–µ —á—É–≤—Å—Ç–≤—É–µ—Ç. –ö–∞–∫ –∏ —ç—Ç–∏ –∫–Ω–æ–ø–∫–∏.', 
                    () => {
                        createButtons([
                            {
                                id: 'return',
                                text: '–í–ï–†–ù–£–¢–¨–°–Ø',
                                action: scenarios.finalChoice
                            }
                        ]);
                    }
                );
            },

            backPath: () => {
                typeText(document.getElementById('narratorText'), 
                    '–ù–∞–∑–∞–¥? –°–µ—Ä—å—ë–∑–Ω–æ? –Ø –∂–µ –≥–æ–≤–æ—Ä–∏–ª, —á—Ç–æ —ç—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏—Ç. –ù–æ —Ö–æ—Ä–æ—à–æ. –í–æ—Ç –≤–∞–º —Ç–∞ –∂–µ —Å–∞–º–∞—è —Ç–æ—á–∫–∞, —Ç–æ–ª—å–∫–æ —Å –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω–æ–π —Ä–µ—á—å—é. –ù–∞–¥–µ—é—Å—å, –≤—ã –¥–æ–≤–æ–ª—å–Ω—ã.', 
                    () => {
                        scenarios.choice1();
                    }
                );
            },

            repetitionPath: () => {
                const repeatCount = state.path.filter(p => p === 'repeat').length;
                
                if (repeatCount >= 3 && !state.achievements.has('sisyphus')) {
                    state.achievements.add('sisyphus');
                    showAchievement('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: –°–∏–∑–∏—Ñ. –í—ã –ø–æ–Ω—è–ª–∏ –ø—Ä–∏—Ä–æ–¥—É –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è.');
                }
                
                const texts = [
                    '–°–Ω–æ–≤–∞? –•–æ—Ä–æ—à–æ. –ö–Ω–æ–ø–∫–∞. –í—ã. –ü–æ–≥–æ–Ω—è. –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ä–∞ –∫–∞–∫ –º–∏—Ä.',
                    '–≠—Ç–æ —É–∂–µ –Ω–µ —Å–º–µ—à–Ω–æ. –í–ø—Ä–æ—á–µ–º, –±—ã–ª–æ –ª–∏ —ç—Ç–æ –∫–æ–≥–¥–∞-—Ç–æ —Å–º–µ—à–Ω–æ?',
                    '–¢—ã –∑–Ω–∞–µ—à—å —á—Ç–æ —Ç–∞–∫–æ–µ –±–µ–∑—É–º–∏–µ? –≠—Ç–æ –¥–µ–ª–∞—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ù–æ —Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–π.',
                    '–Ø —É—Å—Ç–∞–ª. –í—ã —É—Å—Ç–∞–ª–∏. –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–ª–∞. –î–∞–≤–∞–π—Ç–µ –∑–∞–∫–æ–Ω—á–∏–º —ç—Ç–æ.'
                ];
                
                typeText(document.getElementById('narratorText'), 
                    texts[Math.min(repeatCount, texts.length - 1)], 
                    () => {
                        if (repeatCount >= 3) {
                            scenarios.finalChoice();
                        } else {
                            scenarios.redPath();
                        }
                    }
                );
            },

            nirvana: () => {
                if (!state.achievements.has('nirvana')) {
                    state.achievements.add('nirvana');
                    showAchievement('–î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: –ù–∏—Ä–≤–∞–Ω–∞. –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ –∫–Ω–æ–ø–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏—è.');
                }
                
                typeText(document.getElementById('narratorText'), 
                    '–í—ã –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç–µ –º–µ–Ω—è? –ú–µ–Ω—è? –†–∞—Å—Å–∫–∞–∑—á–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Å–º–µ—Ö–∞–µ—Ç—Å—è –Ω–∞–¥ –≤–∞—à–∏–º–∏ –≤—ã–±–æ—Ä–∞–º–∏? –ö–∞–∫ –º–∏–ª–æ. –≠—Ç–æ –ø–æ—á—Ç–∏ —Ç—Ä–æ–≥–∞—Ç–µ–ª—å–Ω–æ. –ü–æ—á—Ç–∏. –ß—Ç–æ –∂, –≤–æ—Ç –≤–∞—à–∞ –Ω–∞–≥—Ä–∞–¥–∞: –µ—â—ë –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞.', 
                    () => {
                        scenarios.finalChoice();
                    }
                );
            },

            finalChoice: () => {
                const narratorText = document.getElementById('narratorText');
                let text = '–ú—ã –ø–æ–¥–æ—à–ª–∏ –∫ —Ñ–∏–Ω–∞–ª—É. –£ –≤–∞—Å –µ—Å—Ç—å –≤—ã–±–æ—Ä. ';
                
                if (state.achievements.size >= 3) {
                    text += '–í—ã —Å–æ–±—Ä–∞–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –í–ø–µ—á–∞—Ç–ª—è–µ—Ç. –ë–µ—Å–ø–æ–ª–µ–∑–Ω–æ, –Ω–æ –≤–ø–µ—á–∞—Ç–ª—è–µ—Ç. ';
                }
                
                text += '–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ, –ø—Ä–∏–Ω—è—Ç—å –∞–±—Å—É—Ä–¥ –∏–ª–∏... –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞–π—Ç–∏ –Ω–µ–≤–∏–¥–∏–º—É—é –∫–Ω–æ–ø–∫—É –æ—Ç—á–∞—è–Ω–∏—è. –û–Ω–∞ –≥–¥–µ-—Ç–æ –∑–¥–µ—Å—å. –ú–æ–∂–µ—Ç –±—ã—Ç—å.';
                
                typeText(narratorText, text, () => {
                    createButtons([
                        {
                            id: 'restart',
                            text: '–ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û',
                            action: () => {
                                state.clicks = 0;
                                state.path = [];
                                scenarios.start();
                            }
                        },
                        {
                            id: 'accept',
                            text: '–ü–†–ò–ù–Ø–¢–¨ –ê–ë–°–£–†–î',
                            action: scenarios.ending
                        }
                    ]);
                    
                    // –ù–µ–≤–∏–¥–∏–º–∞—è –∫–Ω–æ–ø–∫–∞
                    const invisBtn = document.createElement('button');
                    invisBtn.className = 'meta-button invisible-button';
                    invisBtn.textContent = '–û–¢–ß–ê–Ø–ù–ò–ï';
                    invisBtn.onclick = scenarios.secretEnding;
                    document.getElementById('buttonContainer').appendChild(invisBtn);
                });
            },

            ending: () => {
                typeText(document.getElementById('narratorText'), 
                    `–ü–æ–∑–¥—Ä–∞–≤–ª—è—é. –í—ã –ø—Ä–æ—à–ª–∏ –ú—É–∑–µ–π –ú–µ—Ç–∞-–ö–Ω–æ–ø–æ–∫. –í—ã –Ω–∞–∂–∞–ª–∏ ${state.clicks} –∫–Ω–æ–ø–æ–∫. –ü–æ–ª—É—á–∏–ª–∏ ${state.achievements.size} –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π. –£–∑–Ω–∞–ª–∏, —á—Ç–æ –≤—Å—ë —ç—Ç–æ –±—ã–ª–æ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ. –ù–æ –≤—ã –∂–µ –∑–Ω–∞–ª–∏ —ç—Ç–æ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞, –ø—Ä–∞–≤–¥–∞? –î–æ –≤—Å—Ç—Ä–µ—á–∏. –ú–æ–∂–µ—Ç –±—ã—Ç—å.`, 
                    () => {
                        setTimeout(() => {
                            if (confirm('–ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞?')) {
                                location.reload();
                            }
                        }, 3000);
                    }
                );
            },

            secretEnding: () => {
                if (!state.achievements.has('despair')) {
                    state.achievements.add('despair');
                    showAchievement('–°–µ–∫—Ä–µ—Ç–Ω–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: –û—Ç—á–∞—è–Ω–∏–µ. –í—ã –Ω–∞—à–ª–∏ —Ç–æ, —á—Ç–æ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã–ª–∏ –Ω–∞–π—Ç–∏.');
                }
                
                document.body.classList.add('glitch');
                typeText(document.getElementById('narratorText'), 
                    '–í—ã... –Ω–∞—à–ª–∏ –µ—ë. –ù–µ–≤–∏–¥–∏–º—É—é –∫–Ω–æ–ø–∫—É. –Ø –¥–∞–∂–µ –Ω–µ –¥—É–º–∞–ª, —á—Ç–æ –∫—Ç–æ-—Ç–æ –±—É–¥–µ—Ç –∏—Å–∫–∞—Ç—å. –í—ã —Ä–∞–∑—Ä—É—à–∏–ª–∏ –ø–æ–≤–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ. –í—ã —Å–ª–æ–º–∞–ª–∏ –∏–≥—Ä—É. –í—ã... —Å–≤–æ–±–æ–¥–Ω—ã? –ò–ª–∏ –Ω–µ—Ç. –Ø –Ω–µ –∑–Ω–∞—é –±–æ–ª—å—à–µ. –í—Å—ë –ø–æ—Ç–µ—Ä—è–ª–æ —Å–º—ã—Å–ª. –ü–æ–∑–¥—Ä–∞–≤–ª—è—é.', 
                    () => {
                        setTimeout(() => {
                            document.body.style.background = '#fff';
                            document.getElementById('narratorText').textContent = '–ö–æ–Ω–µ—Ü?';
                            document.getElementById('narratorText').style.color = '#000';
                            document.getElementById('buttonContainer').innerHTML = '';
                            document.getElementById('stats').style.display = 'none';
                        }, 2000);
                    }
                );
            }
        };

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
        window.addEventListener('beforeunload', (e) => {
            if (state.clicks > 0) {
                e.preventDefault();
                e.returnValue = '–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —É—Ç–µ—Ä—è–Ω. –•–æ—Ç—è –∫–∞–∫–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å? –í—ã –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∏–º–∞–ª–∏ –∫–Ω–æ–ø–∫–∏.';
                return e.returnValue;
            }
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
        let idleTimer;
        function resetIdle() {
            clearTimeout(idleTimer);
            idleTimer = setTimeout(() => {
                console.log('%c–í—ã –≤—Å—ë –µ—â—ë –∑–¥–µ—Å—å? –í–ø–µ—á–∞—Ç–ª—è–µ—Ç.', 'color: #00ff88; font-size: 14px;');
            }, 30000);
        }
        document.addEventListener('mousemove', resetIdle);
        document.addEventListener('click', resetIdle);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateStats();
        updateVisitCounter();
        scenarios.start();
        resetIdle();
    </script>
</body>
</html>
