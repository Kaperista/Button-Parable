<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUTTON-PARABLE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(0, 255, 136, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(255, 0, 136, 0.15) 0%, transparent 50%);
            animation: bgPulse 8s ease-in-out infinite;
            z-index: 0;
        }

        @keyframes bgPulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .particle {
            position: fixed;
            width: 3px;
            height: 3px;
            background: rgba(0, 255, 136, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: float linear infinite;
            z-index: 1;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-10vh) translateX(100px) rotate(360deg); opacity: 0; }
        }

        .glitch {
            animation: glitchAnim 0.3s;
        }

        @keyframes glitchAnim {
            0% { transform: translate(0); filter: hue-rotate(0deg); }
            20% { transform: translate(-4px, 4px); filter: hue-rotate(90deg); }
            40% { transform: translate(-4px, -4px); filter: hue-rotate(180deg); }
            60% { transform: translate(4px, 4px); filter: hue-rotate(270deg); }
            80% { transform: translate(4px, -4px); filter: hue-rotate(360deg); }
            100% { transform: translate(0); filter: hue-rotate(0deg); }
        }

        .narrator-box {
            background: rgba(10, 10, 10, 0.85);
            border: 2px solid #00ff88;
            border-radius: 20px;
            padding: 50px;
            max-width: 900px;
            width: 90%;
            margin-bottom: 40px;
            box-shadow: 
                0 0 60px rgba(0, 255, 136, 0.5),
                inset 0 0 60px rgba(0, 255, 136, 0.08);
            min-height: 250px;
            position: relative;
            z-index: 10;
            backdrop-filter: blur(20px);
            animation: boxGlow 4s ease-in-out infinite;
        }

        @keyframes boxGlow {
            0%, 100% { 
                box-shadow: 0 0 60px rgba(0, 255, 136, 0.5), inset 0 0 60px rgba(0, 255, 136, 0.08);
                border-color: #00ff88;
            }
            50% { 
                box-shadow: 0 0 90px rgba(0, 255, 136, 0.8), inset 0 0 90px rgba(0, 255, 136, 0.15);
                border-color: #00ffaa;
            }
        }

        .narrator-box::before,
        .narrator-box::after {
            position: absolute;
            font-size: 28px;
            color: #00ff88;
            opacity: 0.6;
            animation: cornerPulse 2s ease-in-out infinite;
        }

        .narrator-box::before {
            content: 'â—¢';
            top: 12px;
            left: 12px;
        }

        .narrator-box::after {
            content: 'â—£';
            bottom: 12px;
            right: 12px;
        }

        @keyframes cornerPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .narrator-text {
            font-size: 22px;
            line-height: 1.9;
            margin-bottom: 25px;
            text-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
            min-height: 100px;
        }

        .typing::after {
            content: 'â–Š';
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        .button-container {
            display: flex;
            gap: 25px;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 35px;
        }

        .meta-button {
            padding: 20px 50px;
            font-size: 19px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            border: 3px solid #00ff88;
            background: rgba(0, 255, 136, 0.08);
            color: #00ff88;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            text-transform: uppercase;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            letter-spacing: 3px;
        }

        .meta-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.5), transparent);
            transition: left 0.6s;
        }

        .meta-button:hover::before {
            left: 100%;
        }

        .meta-button:hover {
            background: rgba(0, 255, 136, 0.25);
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.8);
            transform: scale(1.08) translateY(-3px);
            border-color: #00ffbb;
        }

        .meta-button:active {
            transform: scale(0.95);
        }

        .meta-button.runaway {
            position: fixed;
            transition: all 0.25s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 100;
        }

        .stats {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(10, 10, 10, 0.9);
            padding: 25px;
            border: 2px solid #00ff88;
            border-radius: 12px;
            font-size: 14px;
            min-width: 280px;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
            z-index: 1000;
        }

        .stats-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 18px;
            color: #00ff88;
            text-align: center;
            border-bottom: 2px solid #00ff88;
            padding-bottom: 12px;
            letter-spacing: 2px;
        }

        .stats-item {
            margin: 12px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
        }

        .stats-value {
            color: #00ffaa;
            font-weight: bold;
        }

        .reputation-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 8px;
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .reputation-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ffaa44, #44ff44);
            transition: width 0.6s ease-out;
            width: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .control-btn {
            padding: 12px 18px;
            background: rgba(136, 68, 255, 0.2);
            border: 2px solid #8844ff;
            color: #8844ff;
            cursor: pointer;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(136, 68, 255, 0.4);
            box-shadow: 0 0 20px rgba(136, 68, 255, 0.6);
            transform: translateY(-2px);
        }

        .control-btn.active {
            background: rgba(136, 68, 255, 0.5);
            border-color: #aa66ff;
        }

        .achievement {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            padding: 25px 50px;
            border-radius: 18px;
            font-weight: bold;
            font-size: 18px;
            animation: achievementSlide 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55), achievementOut 0.6s 4s;
            display: none;
            box-shadow: 0 15px 40px rgba(255, 215, 0, 0.6);
            z-index: 2000;
            border: 4px solid #ff8c00;
            text-align: center;
        }

        @keyframes achievementSlide {
            from { transform: translate(-50%, -200%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        @keyframes achievementOut {
            from { transform: translate(-50%, 0); opacity: 1; }
            to { transform: translate(-50%, -200%); opacity: 0; }
        }

        .visit-counter {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(10, 10, 10, 0.9);
            padding: 18px 25px;
            border: 2px solid #ff4488;
            border-radius: 12px;
            font-size: 14px;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 30px rgba(255, 68, 136, 0.4);
            z-index: 1000;
        }

        .invisible-button {
            opacity: 0;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            transition: opacity 0.5s;
        }

        .invisible-button:hover {
            opacity: 0.4;
        }

        .ending-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.97);
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 5000;
            animation: fadeIn 1.5s;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .ending-title {
            font-size: 52px;
            color: #00ff88;
            margin-bottom: 40px;
            text-shadow: 0 0 30px rgba(0, 255, 136, 1);
            animation: titleGlow 2.5s ease-in-out infinite;
            text-align: center;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 30px rgba(0, 255, 136, 1); }
            50% { text-shadow: 0 0 60px rgba(0, 255, 136, 1), 0 0 90px rgba(0, 255, 136, 0.6); }
        }

        .ending-stats {
            font-size: 20px;
            line-height: 2.2;
            text-align: center;
            max-width: 700px;
            background: rgba(10, 10, 10, 0.8);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid #00ff88;
            box-shadow: 0 0 40px rgba(0, 255, 136, 0.4);
        }

        .ending-stats h3 {
            color: #00ffaa;
            margin: 20px 0 10px 0;
        }

        @media (max-width: 768px) {
            .narrator-box {
                padding: 30px 20px;
                max-width: 95%;
            }
            
            .narrator-text {
                font-size: 17px;
            }

            .stats {
                font-size: 12px;
                padding: 15px;
                min-width: 220px;
            }

            .meta-button {
                padding: 15px 30px;
                font-size: 15px;
            }

            .ending-title {
                font-size: 36px;
            }

            .ending-stats {
                font-size: 16px;
                padding: 25px;
            }

            .controls {
                flex-direction: column;
                gap: 5px;
            }

            .control-btn {
                padding: 8px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <script>
        for(let i = 0; i < 25; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = Math.random() * 100 + '%';
            p.style.animationDelay = Math.random() * 12 + 's';
            p.style.animationDuration = (Math.random() * 12 + 10) + 's';
            document.body.appendChild(p);
        }
    </script>

    <div class="achievement" id="achievement"></div>
    <div class="ending-screen" id="endingScreen">
        <div class="ending-title" id="endingTitle"></div>
        <div class="ending-stats" id="endingStats"></div>
    </div>
    
    <div class="controls">
        <button class="control-btn" id="voiceBtn" onclick="toggleVoice()">ðŸ”‡ Voice</button>
        <button class="control-btn" onclick="saveGame()">ðŸ’¾ Save Game</button>
        <button class="control-btn" onclick="loadGame()">ðŸ“‚ Load Game</button>
    </div>

    <div class="stats" id="stats">
        <div class="stats-title">â—ˆ STATISTICS â—ˆ</div>
        <div class="stats-item">
            <span>Buttons clicked:</span>
            <span class="stats-value" id="clickCount">0</span>
        </div>
        <div class="stats-item">
            <span>Meaninglessness:</span>
            <span class="stats-value" id="meaningless">0%</span>
        </div>
        <div class="stats-item">
            <span>Existential Crisis:</span>
            <span class="stats-value" id="crisis">low</span>
        </div>
        <div class="stats-item">
            <span>Achievements:</span>
            <span class="stats-value" id="achievementCount">0/20</span>
        </div>
        <div class="stats-item">
            <span>Endings:</span>
            <span class="stats-value" id="endingCount">0/15</span>
        </div>
        <div class="stats-item">
            <span>Reputation:</span>
            <div class="reputation-bar">
                <div class="reputation-fill" id="reputationFill"></div>
            </div>
        </div>
    </div>

    <div class="visit-counter" id="visitCounter"></div>

    <div class="narrator-box" id="narratorBox">
        <div class="narrator-text" id="narratorText"></div>
        <div class="button-container" id="buttonContainer"></div>
    </div>

    <script>
        // ÐžÐ—Ð’Ð£Ð§ÐšÐ
        let synth = window.speechSynthesis;
        let voiceEnabled = false;
        let voices = [];

        function loadVoices() {
            voices = synth.getVoices().filter(v => v.lang.startsWith('ru'));
            if (voices.length === 0) voices = synth.getVoices();
        }

        if (synth.onvoiceschanged !== undefined) {
            synth.onvoiceschanged = loadVoices;
        }
        loadVoices();

        function toggleVoice() {
            voiceEnabled = !voiceEnabled;
            const btn = document.getElementById('voiceBtn');
            btn.textContent = voiceEnabled ? 'ðŸ”Š ÐžÐ—Ð’Ð£Ð§ÐšÐ' : 'ðŸ”‡ ÐžÐ—Ð’Ð£Ð§ÐšÐ';
            btn.classList.toggle('active');
            if (voiceEnabled) speak('ÐžÐ·Ð²ÑƒÑ‡ÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°.');
        }

        function speak(text) {
            if (!voiceEnabled || !synth) return;
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = 0.85;
            utterance.pitch = 0.75;
            if (voices.length > 0) utterance.voice = voices[0];
            synth.speak(utterance);
        }

        // Ð¡ÐžÐ¡Ð¢ÐžÐ¯ÐÐ˜Ð•
        const state = {
            clicks: 0,
            path: [],
            achievements: new Set(),
            endings: new Set(),
            visits: 0,
            reputation: 50,
            lastClickTime: 0,
            unlockAll: function() {
                console.log('%câš ï¸ CHEAT ACTIVATED âš ï¸', 'color: #ff0000; font-size: 20px;');
                this.achievements = new Set(['philosopher', 'hunter', 'sisyphus', 'nirvana', 'hacker', 'despair', 'speed', 'patience', 'rebel', 'night_owl', 'early_bird', 'persistent', 'explorer', 'completionist', 'cheater', 'speed_demon', 'zen_master', 'rebel_soul', 'time_traveler', 'secret_hunter']);
                this.reputation = 0;
                updateStats();
                showAchievement('Cheater. You used the console.');
            }
        };

        // Ð—ÐÐ“Ð Ð£Ð—ÐšÐ
        try {
            const saved = JSON.parse(localStorage.getItem('museumProgress') || '{}');
            state.visits = (saved.visits || 0) + 1;
            if (saved.achievements) state.achievements = new Set(saved.achievements);
            if (saved.endings) state.endings = new Set(saved.endings);
            if (saved.reputation !== undefined) state.reputation = saved.reputation;
        } catch (e) {}

        // Ð¡ÐžÐ¥Ð ÐÐÐ•ÐÐ˜Ð•
        function saveGame() {
            const data = {
                visits: state.visits,
                achievements: Array.from(state.achievements),
                endings: Array.from(state.endings),
                reputation: state.reputation,
                clicks: state.clicks,
                timestamp: Date.now()
            };
            localStorage.setItem('museumProgress', JSON.stringify(data));
            
            const btn = event.target;
            const orig = btn.textContent;
            btn.textContent = 'âœ“ SAVED';
            setTimeout(() => btn.textContent = orig, 2000);
        }

        function loadGame() {
            try {
                const data = JSON.parse(localStorage.getItem('museumProgress') || '{}');
                if (data.achievements) {
                    state.achievements = new Set(data.achievements);
                    state.reputation = data.reputation || 50;
                    state.clicks = data.clicks || 0;
                    updateStats();
                    
                    const btn = event.target;
                    const orig = btn.textContent;
                    btn.textContent = 'âœ“ Ð—ÐÐ“Ð Ð£Ð–Ð•ÐÐž';
                    setTimeout(() => btn.textContent = orig, 2000);
                } else {
                    alert('No saved progress.');
                }
            } catch (e) {
                alert('Error loading game.');
            }
        }

        // UI
        function updateStats() {
            document.getElementById('clickCount').textContent = state.clicks;
            document.getElementById('meaningless').textContent = Math.min(100, state.clicks * 6) + '%';
            
            const crisisLevels = ['low', 'medium', 'high', 'critical', 'BEYOND'];
            const idx = Math.min(4, Math.floor(state.clicks / 10));
            document.getElementById('crisis').textContent = crisisLevels[idx];
            
            document.getElementById('achievementCount').textContent = state.achievements.size + '/20';
            document.getElementById('endingCount').textContent = state.endings.size + '/15';
            
            updateReputation();
        }

        function updateReputation() {
            const fill = document.getElementById('reputationFill');
            fill.style.width = Math.max(0, Math.min(100, state.reputation)) + '%';
        }

        function updateVisitCounter() {
            const counter = document.getElementById('visitCounter');
            const reactions = [
                'First visit',
                'Visit #2. You returned...',
                'Visit #3. Persistent.',
                'Visit #4. Dependency?',
                `Visit #${state.visits}. Impressive.`
            ];
            counter.textContent = reactions[Math.min(state.visits - 1, reactions.length - 1)];
        }

        function showAchievement(text) {
            const ach = document.getElementById('achievement');
            ach.textContent = 'ðŸ† ' + text;
            ach.style.display = 'block';
            setTimeout(() => ach.style.display = 'none', 4500);
        }

        function checkTimeEvents() {
            const hour = new Date().getHours();
            
            if (hour >= 0 && hour < 6 && !state.achievements.has('night_owl')) {
                state.achievements.add('night_owl');
                showAchievement('ÐŸÐ¾Ð»ÑƒÐ½Ð¾Ñ‡Ð½Ð¸Ðº. Ð’Ñ‹ Ð¸Ð³Ñ€Ð°ÐµÑ‚Ðµ Ð³Ð»ÑƒÐ±Ð¾ÐºÐ¾Ð¹ Ð½Ð¾Ñ‡ÑŒÑŽ.');
                state.reputation -= 5;
                updateStats();
            }
            
            if (hour >= 6 && hour < 9 && !state.achievements.has('early_bird')) {
                state.achievements.add('early_bird');
                showAchievement('Ð Ð°Ð½Ð½ÑÑ Ð¿Ñ‚Ð°ÑˆÐºÐ°. Ð”Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾!');
                state.reputation += 10;
                updateStats();
            }
        }

        function typeText(element, text, callback, speed = 25) {
            element.textContent = '';
            element.classList.add('typing');
            let i = 0;
            
            speak(text);
            
            const interval = setInterval(() => {
                if (i < text.length) {
                    element.textContent += text[i];
                    i++;
                } else {
                    clearInterval(interval);
                    element.classList.remove('typing');
                    if (callback) callback();
                }
            }, speed);
        }

        function createButtons(buttons) {
            const container = document.getElementById('buttonContainer');
            container.innerHTML = '';
            
            buttons.forEach(btn => {
                const button = document.createElement('button');
                button.className = 'meta-button';
                button.textContent = btn.text;
                button.onclick = () => {
                    state.clicks++;
                    state.path.push(btn.id);
                    updateStats();
                    
                    const speed = Date.now() - state.lastClickTime;
                    if (speed < 800 && state.clicks > 5 && !state.achievements.has('speed_demon')) {
                        state.achievements.add('speed_demon');
                        showAchievement('Speedrun. U too fst!');
                        state.reputation -= 8;
                        updateStats();
                    }
                    state.lastClickTime = Date.now();
                    
                    btn.action();
                };
                
                if (btn.special === 'runaway') {
                    let escapes = 0;
                    button.onmouseenter = () => {
                        if (!button.classList.contains('runaway')) {
                            button.classList.add('runaway');
                        }
                        escapes++;
                        const x = Math.random() * (window.innerWidth - 250);
                        const y = Math.random() * (window.innerHeight - 100);
                        button.style.left = x + 'px';
                        button.style.top = y + 'px';
                        
                        if (escapes > 15 && !state.achievements.has('persistent')) {
                            state.achievements.add('persistent');
                            showAchievement('Persistence. You don\'t give up.');
                            state.reputation += 20;
                            updateStats();
                        }
                    };
                }
                
                container.appendChild(button);
            });
        }

        function showEnding(title, stats, endingId) {
            state.endings.add(endingId);
            
            const screen = document.getElementById('endingScreen');
            document.getElementById('endingTitle').textContent = title;
            document.getElementById('endingStats').innerHTML = stats;
            screen.style.display = 'flex';
            
            setTimeout(() => {
                if (confirm('Play Again?')) {
                    screen.style.display = 'none';
                    state.clicks = 0;
                    state.path = [];
                    scenarios.start();
                }
            }, 6000);
        }

        // DIALOGS
        const dialogParts = {
            greetings: ['Greetings', 'Welcome', 'You are here', 'Before you'],
            sarcasm: ['Bravo', 'Impressive', 'Unexpected', 'Original', 'Genius'],
            reactions: ['So fast?', 'Slowly but surely', 'You thought?', 'Interesting choice'],
            philosophy: ['What is a button?', 'Is free will free?', 'Does choice exist?', 'What does it mean to press?']
        };

        function generateDialog(type) {
            const { reputation } = state;
            let text = '';
            
            if (reputation < 30) {
                text += 'I see you lost my trust. ';
            } else if (reputation > 70) {
                text += 'You please me. A little bit. Maybe. ';
            }
            
            const sarcasm = dialogParts.sarcasm[Math.floor(Math.random() * dialogParts.sarcasm.length)];
            
            if (type === 'click') {
                text += `${sarcasm}. ${dialogParts.reactions[Math.floor(Math.random() * dialogParts.reactions.length)]}`;
            } else if (type === 'philosophy') {
                text += dialogParts.philosophy[Math.floor(Math.random() * dialogParts.philosophy.length)];
            }
            
            return text;
        }

        // SCENARIOS
        const scenarios = {
            start: () => {
                checkTimeEvents();
                
                let text = dialogParts.greetings[Math.floor(Math.random() * dialogParts.greetings.length)] + ' in the Meta-Button Museum. ';
                
                if (state.visits > 1) {
                    const returningTexts = [
                        `Oh. You're back. This is your visit number ${state.visits}. ${state.visits > 5 ? 'Do you really have nothing better to do?' : 'I... missed you.'}`,
                        `Visit #${state.visits}. You remember there's nothing valuable here?`,
                        `${state.visits} times. That's already a diagnosis.`
                    ];
                    text = returningTexts[Math.min(state.visits - 2, returningTexts.length - 1)] + ' ';
                }

                text += 'Before you is the "START" button. Press it. Or don\'t. But we both know you will.';
                
                typeText(document.getElementById('narratorText'), text, () => {
                    createButtons([{
                        id: 'start',
                        text: 'START',
                        action: scenarios.choice1
                    }]);
                });
            },

            choice1: () => {
                const texts = [
                    'Excellent. Predictable, but excellent. Now you have a choice. Red button or Blue button. Choose wisely. Though it doesn\'t matter.',
                    'You pressed the button. Congratulations. Was that a difficult decision? It will be harder now.',
                    generateDialog('click') + ' Let\'s continue this meaningless procedure.'
                ];
                
                const narratorBox = document.getElementById('narratorBox');
                if (Math.random() < 0.1) narratorBox.classList.add('glitch');
                setTimeout(() => narratorBox.classList.remove('glitch'), 300);
                
                typeText(document.getElementById('narratorText'), texts[Math.floor(Math.random() * texts.length)], () => {
                    createButtons([
                        { id: 'red', text: 'RED', action: scenarios.redPath },
                        { id: 'blue', text: 'BLUE', action: scenarios.bluePath },
                        { id: 'wait', text: 'WAIT', action: scenarios.waitPath }
                    ]);
                });
            },

            redPath: () => {
                document.getElementById('narratorBox').classList.add('glitch');
                setTimeout(() => document.getElementById('narratorBox').classList.remove('glitch'), 300);
                
                const texts = [
                    'Red. Classic. You chose danger. Or safety? I never remember. Either way, a button will now appear that runs away from you. Try to catch it.',
                    'Red button. The color of blood. Or love? Philosophy tires me. Catch the button.'
                ];
                
                typeText(document.getElementById('narratorText'), texts[Math.floor(Math.random() * texts.length)], () => {
                    createButtons([
                        { id: 'runaway', text: 'CATCH ME', special: 'runaway', action: scenarios.caughtButton },
                        { id: 'give_up', text: 'GIVE UP', action: scenarios.giveUp }
                    ]);
                });
            },

            bluePath: () => {
                const texts = [
                    'Blue. Interesting. Do you know that blue symbolizes calmness? Or sadness? Probably the latter in your case.',
                    'Blue. Like the sky. Or the void. Choose for yourself.'
                ];
                
                typeText(document.getElementById('narratorText'), texts[Math.floor(Math.random() * texts.length)], () => {
                    createButtons([
                        { id: 'void', text: 'TO THE VOID', action: scenarios.voidPath },
                        { id: 'back', text: 'BACK', action: scenarios.backPath }
                    ]);
                });
            },

            waitPath: () => {
                if (!state.achievements.has('zen_master')) {
                    state.achievements.add('zen_master');
                    showAchievement('Master of Zen. You chose contemplation.');
                    state.reputation += 15;
                    updateStats();
                }
                
                typeText(document.getElementById('narratorText'), 
                    'Ah. Choosing not to choose. Deeply thoughtful. You simply stand here and look at the screen. Here is a button for your patience.', 
                    () => {
                        createButtons([
                            { id: 'patience', text: 'THANK YOU', action: scenarios.nirvana }
                        ]);
                    }
                );
            },

            caughtButton: () => {
                if (!state.achievements.has('hunter')) {
                    state.achievements.add('hunter');
                    showAchievement('Hunter. You caught the runaway button.');
                    state.reputation += 12;
                    updateStats();
                }
                
                typeText(document.getElementById('narratorText'), 
                    'Incredible. You caught the button. Your reward: the realization that you spent time chasing pixels.', 
                    () => {
                        createButtons([
                            { id: 'repeat', text: 'REPEAT', action: scenarios.repetitionPath },
                            { id: 'continue', text: 'CONTINUE', action: scenarios.finalChoice }
                        ]);
                    }
                );
            },

            giveUp: () => {
                typeText(document.getElementById('narratorText'), 
                    'You gave up. A wise choice. Why chase after something that doesn\'t want to be caught?', 
                    () => {
                        createButtons([
                            { id: 'continue', text: 'CONTINUE', action: scenarios.finalChoice }
                        ]);
                    }
                );
            },

            voidPath: () => {
                document.body.style.background = '#000';
                setTimeout(() => {
                    document.body.style.background = 'linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0a0a0a 100%)';
                }, 2500);
                
                if (!state.achievements.has('explorer')) {
                    state.achievements.add('explorer');
                    showAchievement('Explorer. You looked into the void.');
                    updateStats();
                }
                
                typeText(document.getElementById('narratorText'), 
                    'You stepped into the void. It is dark. And quiet. Though, you can return.', 
                    () => {
                        createButtons([
                            { id: 'return', text: 'RETURN', action: scenarios.finalChoice }
                        ]);
                    }
                );
            },

            backPath: () => {
                state.reputation -= 3;
                updateReputation();
                
                typeText(document.getElementById('narratorText'), 
                    'Back? Seriously? I told you this wouldn\'t change anything.', 
                    () => scenarios.choice1()
                );
            },

            repetitionPath: () => {
                const repeatCount = state.path.filter(p => p === 'repeat').length;
                
                if (repeatCount >= 5 && !state.achievements.has('sisyphus')) {
                    state.achievements.add('sisyphus');
                    showAchievement('Sisyphus. You understood the nature of repetition.');
                    updateStats();
                }
                
                const texts = [
                    'Again? Fine. The button. You. The chase.',
                    'This is no longer funny.',
                    'I\'m tired. You\'re tired. Let\'s end this.'
                ];
                
                typeText(document.getElementById('narratorText'), 
                    texts[Math.min(repeatCount, texts.length - 1)], 
                    () => {
                        if (repeatCount >= 4) {
                            scenarios.finalChoice();
                        } else {
                            scenarios.redPath();
                        }
                    }
                );
            },

            nirvana: () => {
                if (!state.achievements.has('nirvana')) {
                    state.achievements.add('nirvana');
                    showAchievement('Nirvana. You reached button enlightenment.');
                    state.reputation += 25;
                    updateStats();
                }
                
                typeText(document.getElementById('narratorText'), 
                    'You thank me? Me? The narrator who laughs at your choices? How cute.', 
                    () => scenarios.finalChoice()
                );
            },

            finalChoice: () => {
                let text = 'We have reached the end. You have a choice. ';
                
                if (state.achievements.size >= 5) {
                    text += 'You collected many achievements. Impressive. ';
                }
                
                if (state.reputation > 70) {
                    text += 'You earned my respect. ';
                } else if (state.reputation < 30) {
                    text += 'You disappointed me. ';
                }

                text += 'You can start over or accept the absurd. Or find the invisible button at the bottom of the screen.';
                
                typeText(document.getElementById('narratorText'), text, () => {
                    createButtons([
                        { id: 'restart', text: 'START OVER', action: () => {
                            state.clicks = 0;
                            state.path = [];
                            scenarios.start();
                        }},
                        { id: 'accept', text: 'ACCEPT THE ABSURD', action: scenarios.normalEnding }
                    ]);
                    
                    const invisBtn = document.createElement('button');
                    invisBtn.className = 'meta-button invisible-button';
                    invisBtn.textContent = 'DESPAIR';
                    invisBtn.onclick = scenarios.despairEnding;
                    document.getElementById('buttonContainer').appendChild(invisBtn);
                });
            },

            normalEnding: () => {
                if (!state.achievements.has('completionist') && state.achievements.size >= 10) {
                    state.achievements.add('completionist');
                    updateStats();
                }
                
                showEnding(
                    'ENDING: ACCEPTANCE',
                    `Congratulations. You have completed the Meta-Button Museum.<br><br>
                    <h3>Your statistics:</h3>
                    Buttons clicked: ${state.clicks}<br>
                    Achievements: ${state.achievements.size}/20<br>
                    Endings: ${state.endings.size + 1}/15<br>
                    Reputation: ${state.reputation}%<br><br>
                    You realized that everything was meaningless.<br>
                    But you knew that from the beginning, right?`,
                    'normal_ending'
                );
            },

            despairEnding: () => {
                if (!state.achievements.has('despair')) {
                    state.achievements.add('despair');
                    showAchievement('Despair. You found the secret!');
                }
                
                document.body.classList.add('glitch');
                showEnding(
                    'ENDING: DESPAIR',
                    `You... found it. The invisible button.<br><br>
                    I didn't even think someone would look for it.<br>
                    You destroyed the narrative.<br>
                    You broke the game.<br>
                    You... are free?<br><br>
                    Congratulations.`,
                    'despair_ending'
                );
            }
        };

        // Ð¡ÐžÐ‘Ð«Ð¢Ð˜Ð¯
        window.addEventListener('beforeunload', (e) => {
            if (state.clicks > 0) {
                e.preventDefault();
                e.returnValue = 'Are you sure? Your progress will be lost.';
                return e.returnValue;
            }
        });

        let idleTimer;
        function resetIdle() {
            clearTimeout(idleTimer);
            idleTimer = setTimeout(() => {
                if (!state.achievements.has('patience')) {
                    state.achievements.add('patience');
                    showAchievement('Patience. You waited very long.');
                    state.reputation += 10;
                    updateStats();
                }
            }, 45000);
        }

        document.addEventListener('mousemove', resetIdle);
        document.addEventListener('click', resetIdle);

        let konamiCode = [];
        const konami = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];

        document.addEventListener('keydown', (e) => {
            konamiCode.push(e.key);
            if (konamiCode.length > 10) konamiCode.shift();
            
            if (JSON.stringify(konamiCode) === JSON.stringify(konami)) {
                if (!state.achievements.has('time_traveler')) {
                    state.achievements.add('time_traveler');
                    showAchievement('Time Traveler. Konami code works!');
                    state.reputation += 30;
                    updateStats();
                }
            }
        });

        setInterval(() => {
            if (state.clicks > 0) {
                localStorage.setItem('museumProgress', JSON.stringify({
                    visits: state.visits,
                    achievements: Array.from(state.achievements),
                    endings: Array.from(state.endings),
                    reputation: state.reputation,
                    clicks: state.clicks
                }));
            }
        }, 30000);

        // ÐšÐžÐÐ¡ÐžÐ›Ð¬
        console.log('%câ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 'color: #00ff88; font-weight: bold;');
        console.log('%câ•‘           BUTTON-PARABLE          â•‘', 'color: #00ff88; font-weight: bold;');
        console.log('%câ•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'color: #00ff88; font-weight: bold;');
        console.log('%cÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹: state.unlockAll() - Unlock all', 'color: #8844ff;');

        // Ð˜ÐÐ˜Ð¦Ð˜ÐÐ›Ð˜Ð—ÐÐ¦Ð˜Ð¯
        updateStats();
        updateVisitCounter();
        checkTimeEvents();
        resetIdle();
        
        window.museumState = state;
        window.museumScenarios = scenarios;
        
        setTimeout(() => scenarios.start(), 500);
    </script>
</body>
</html>
